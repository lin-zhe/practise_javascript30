<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Type Ahead ğŸ‘€</title>
    <link rel="stylesheet" href="/typeAhead/style.css">
</head>

<body>
    <form class="search-form">
        <input type="text" class="search" placeholder="City or State">
        <ul class="suggestions">
            <li>Filter for a city</li>
            <li>or a state</li>
        </ul>
    </form>
    <script>
        const endpoint =
            'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

        const cities = [];
        fetch(endpoint)
            .then(blob => blob.json())
            .then(data => cities.push(...data));
        //push æ˜¯é’ˆå¯¹constå˜é‡åŠ å…¥æ•°æ®çš„æ–¹æ³•
        //...æ˜¯ES6æ–°åŠ çš„ç‰¹æ€§ï¼Œå¯ä»¥å°†éå†æ¯ä¸€ä¸ªæ•°æ®ä¸€ä¸ªä¸ªæ”¾åˆ°æ•°ç»„äº†

        function findMatches(WordToMatch, cities) {
            return cities.filter(place => {
                const regex = new RegExp(WordToMatch, 'gi'); //åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œg global i å¯¹å¤§å°å†™ä¸æ•æ„Ÿ
                return place.city.match(regex) || place.state.match(regex); //æŸ¥æ‰¾stateæˆ–è€…citiesçš„åå­—
            })

        }

        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        //\Béå•è¯è¾¹ç•ŒåŒ¹é…ï¼Œ\bå•è¯è¾¹ç•Œ  å•è¯è¾¹ç•Œï¼ˆå­—æ¯ä¸ç©ºæ ¼ï¼‰ d{3},è¿ç»­åŒ¹é…3æ¬¡ è¿™å¥è¯çš„æ„æ€æ˜¯åŒ¹é…3nï¼ˆæ•´æ•°å­—ï¼‰+1ï¼ˆéæ•°å­—ï¼‰è¿™ç§ç»„åˆï¼ˆå‘åè´ªå©ªåœ°æ‰¾å¯»ï¼‰å‰çš„éå•è¯è¾¹ç•Œï¼ˆ1ï¼Œ000æˆ–1ï¼Œ000ï¼Œ000ï¼‰ç¬¬äºŒä¸ªå°±æ˜¯å‡ºç°è¿™ç§çš„ä½ç½®
        function displayMatches() {
            // const matchArray = findMatches(this.value, cities);
            console.log(this.value); //è¾“å…¥çš„å€¼
            const matchArray = findMatches(this.value, cities);
            const html = matchArray.map(place => {
                const regex = new RegExp(this.value, 'gi');
                const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
                //replace æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å­å­—ç¬¦ä¸²æˆ–è¦æ›¿æ¢çš„æ¨¡å¼çš„ RegExp å¯¹è±¡ã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ã€‚è§„å®šäº†æ›¿æ¢æ–‡æœ¬æˆ–ç”Ÿæˆæ›¿æ¢æ–‡æœ¬çš„å‡½æ•°ã€‚
                const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
                return `
                <li>
                    <span class="name">${cityName},${stateName}</span>
                    <span class="population">${numberWithCommas(place.population)}</span>
                </li>
                `;
            }).join('');

            suggestions.innerHTML = html;
        }


        const searchInput = document.querySelector('.search');
        const suggestions = document.querySelector('.suggestions');
        searchInput.addEventListener('change', displayMatches);
        searchInput.addEventListener('keyup', displayMatches);
    </script>
</body>

</html>